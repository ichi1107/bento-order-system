<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注文管理 - 弁当注文管理システム</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/store_orders.css">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
</head>
<body>
    <div class="container">
        {% set active_page = 'orders' %}
        {% include 'includes/store_header.html' %}

    <!-- メインコンテンツ -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- ページヘッダー -->
            <section class="page-header">
                <div class="page-header-content">
                    <div>
                        <h2>📦 注文管理</h2>
                        <p>リアルタイムな注文状況の把握</p>
                    </div>
                    <div class="header-stats">
                        <div class="header-badges">
                            <span class="badge badge-info">全: <span id="totalOrdersCount">0</span>件</span>
                            <span class="badge badge-warning">注文受付: <span id="pendingOrdersCount">0</span>件</span>
                            <span class="badge badge-success">準備完了: <span id="readyCount">0</span>件</span>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary" id="refreshBtn" title="最新の状態に更新">
                                🔄 更新
                            </button>
                            <div class="auto-refresh-status" id="autoRefreshStatus">
                                <span class="status-text" id="autoRefreshText">自動更新: 停止中</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- フィルターセクション -->
            <div class="filter-section">
                <!-- 検索バー（最優先の配置） -->
                <div class="filter-group filter-search-primary">
                    <label for="searchInput">🔍 キーワード検索</label>
                    <div class="search-input-wrapper">
                        <input 
                            type="text" 
                            id="searchInput" 
                            class="filter-input search-input" 
                            placeholder="顧客名、メニュー名で検索..."
                            autocomplete="off"
                        >
                        <button class="btn-clear" id="clearSearchBtn" title="検索をクリア" style="display: none;">
                            ✕
                        </button>
                    </div>
                </div>

                <!-- ステータスフィルタ（4ステータス対応） -->
                <div class="filter-group filter-status">
                    <label>📋 注文ステータス</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" class="status-checkbox" value="pending" checked>
                            <span>注文受付</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="status-checkbox" value="ready" checked>
                            <span>準備完了</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="status-checkbox" value="completed">
                            <span>受取完了</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" class="status-checkbox" value="cancelled">
                            <span>キャンセル</span>
                        </label>
                    </div>
                </div>

                <!-- 日付範囲フィルタ（視覚的にグループ化） -->
                <div class="filter-group filter-date-range">
                    <label>📅 注文期間</label>
                    <div class="date-range-wrapper">
                        <div class="date-input-group">
                            <input type="date" id="startDate" class="filter-input date-input" placeholder="開始日">
                        </div>
                        <span class="date-separator">〜</span>
                        <div class="date-input-group">
                            <input type="date" id="endDate" class="filter-input date-input" placeholder="終了日">
                        </div>
                        <button class="btn-clear btn-clear-date" id="clearDateBtn" title="期間をクリア">
                            ✕
                        </button>
                    </div>
                </div>

                <!-- ソート順 -->
                <div class="filter-group filter-sort">
                    <label for="sortOrder">📊 並び順</label>
                    <select id="sortOrder" class="filter-select">
                        <option value="newest">新しい順</option>
                        <option value="oldest">古い順</option>
                        <option value="price_high">金額の高い順</option>
                        <option value="price_low">金額の低い順</option>
                    </select>
                </div>

                <!-- フィルタリセットボタン -->
                <div class="filter-group filter-actions">
                    <label>&nbsp;</label>
                    <button class="btn btn-secondary btn-reset" id="resetFiltersBtn">
                        🔄 すべてリセット
                    </button>
                </div>
            </div>

            <!-- 検索結果表示 -->
            <div class="search-results-info" id="searchResultsInfo" style="display: none;">
                <span class="results-count"></span>
                <span class="active-filters"></span>
            </div>

            <!-- ローディング表示 -->
            <div class="loading-container" id="loadingContainer">
                <div class="spinner"></div>
                <p>注文データを読み込んでいます...</p>
            </div>

            <!-- エラー表示 -->
            <div class="error-container" id="errorContainer" style="display: none;">
                <div class="error-message">
                    <span class="error-icon">⚠️</span>
                    <div class="error-content">
                        <h3>データの取得に失敗しました</h3>
                        <p id="errorMessage"></p>
                        <button class="btn btn-primary" onclick="window.orderManager.loadOrders()">再試行</button>
                    </div>
                </div>
            </div>

            <!-- 注文カード一覧 -->
            <div class="orders-grid" id="ordersGrid">
                <!-- 注文カードはJavaScriptで動的に生成 -->
            </div>

            <!-- 注文なし表示 -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">📭</div>
                <h3>注文がありません</h3>
                <p>現在表示できる注文はありません</p>
            </div>
        </div>
    </main>

    <!-- 注文詳細モーダル -->
    <div class="modal" id="orderDetailModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>注文詳細</h3>
                <button class="modal-close" id="modalCloseBtn" aria-label="閉じる">&times;</button>
            </div>
            <div class="modal-body" id="orderDetailBody">
                <!-- 注文詳細はJavaScriptで動的に生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancelBtn">閉じる</button>
            </div>
        </div>
    </div>

    <!-- トースト通知 -->
    <div class="toast-container" id="toastContainer">
        <!-- トーストメッセージはJavaScriptで動的に生成 -->
    </div>
        </div>
    </main>

    {% include 'includes/store_footer.html' %}
    </div>

    <script src="/static/js/common.js" defer></script>
    <script src="/static/js/store_orders.js" defer></script>
</body>
</html>
